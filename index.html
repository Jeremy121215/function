<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>高级函数绘图工具</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css">
    <!-- 引入Math.js库用于表达式解析 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.6.0/math.min.js"></script>
    <!-- 引入Font Awesome图标 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- 引入Sortable.js用于拖放排序 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
</head>
<body>
    <!-- 主界面容器 -->
    <div class="app-container">
        <!-- 折叠/展开按钮 -->
        <button id="toggleSidebar" class="sidebar-toggle">
            <i class="fas fa-chevron-right" id="toggleIcon"></i>
        </button>
        
        <!-- 侧边栏 -->
        <div class="sidebar" id="sidebar">
            <!-- 标题和基本操作 -->
            <div class="sidebar-header">
                <h1><i class="fas fa-chart-line"></i> 函数绘图</h1>
                <div class="quick-actions">
                    <button id="addFunctionBtn" class="btn-primary" title="添加函数">
                        <i class="fas fa-plus"></i> 添加
                    </button>
                    <button id="batchDeleteBtn" class="btn-secondary" title="批量删除">
                        <i class="fas fa-trash"></i> 批量
                    </button>
                    <button id="settingsBtn" class="btn-secondary" title="设置">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>
            
            <!-- 选项卡导航 -->
            <div class="tab-navigation">
                <button class="tab-btn active" data-tab="functions">函数</button>
                <button class="tab-btn" data-tab="variables">变量</button>
                <button class="tab-btn" data-tab="table">表格</button>
                <button class="tab-btn" data-tab="help">帮助</button>
            </div>
            
            <!-- 函数选项卡 -->
            <div class="tab-content active" id="functions-tab">
                <div class="functions-list" id="functionsList">
                    <!-- 函数项将在这里动态添加 -->
                    <div class="empty-state">
                        <p>点击"添加"按钮创建第一个函数</p>
                    </div>
                </div>
                <div class="batch-controls" id="batchControls">
                    <div class="batch-select-all">
                        <input type="checkbox" id="selectAllFunctions">
                        <label for="selectAllFunctions">全选</label>
                    </div>
                    <button id="deleteSelectedBtn" class="btn-danger">
                        <i class="fas fa-trash"></i> 删除选中
                    </button>
                </div>
            </div>
            
            <!-- 变量选项卡 -->
            <div class="tab-content" id="variables-tab">
                <div class="variable-controls">
                    <button id="addConstantBtn" class="btn-primary">
                        <i class="fas fa-plus"></i> 添加常数
                    </button>
                    <button id="addSliderBtn" class="btn-primary">
                        <i class="fas fa-sliders-h"></i> 添加滑块
                    </button>
                </div>
                <div class="variables-list" id="variablesList">
                    <div class="empty-state">
                        <p>尚未定义任何变量</p>
                        <p class="small">常数和滑块变量可以在函数表达式中使用</p>
                    </div>
                </div>
            </div>
            
            <!-- 表格选项卡 -->
            <div class="tab-content" id="table-tab">
                <div class="table-controls">
                    <div class="control-group">
                        <label for="tableFunction">函数:</label>
                        <select id="tableFunction">
                            <option value="">选择函数</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="tableStart">起始:</label>
                        <input type="number" id="tableStart" value="-5" step="0.5">
                    </div>
                    <div class="control-group">
                        <label for="tableEnd">结束:</label>
                        <input type="number" id="tableEnd" value="5" step="0.5">
                    </div>
                    <div class="control-group">
                        <label for="tableStep">步长:</label>
                        <input type="number" id="tableStep" value="1" step="0.1" min="0.1">
                    </div>
                    <button id="generateTableBtn" class="btn-primary">
                        <i class="fas fa-table"></i> 生成表格
                    </button>
                </div>
                <div class="table-results">
                    <div class="table-header">
                        <span class="table-col">x</span>
                        <span class="table-col">f(x)</span>
                    </div>
                    <div class="table-body" id="tableBody">
                        <div class="empty-state">
                            <p>选择函数并点击"生成表格"</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 帮助选项卡 -->
            <div class="tab-content" id="help-tab">
                <div class="help-content">
                    <h3><i class="fas fa-info-circle"></i> 使用说明</h3>
                    
                    <div class="help-section">
                        <h4>基本操作</h4>
                        <ul>
                            <li><strong>平移视图</strong>: 按住鼠标左键拖动</li>
                            <li><strong>缩放视图</strong>: 使用鼠标滚轮或触摸屏双指缩放</li>
                            <li><strong>1:1比例</strong>: x轴和y轴保持相同缩放比例</li>
                        </ul>
                    </div>
                    
                    <div class="help-section">
                        <h4>数学表达式语法</h4>
                        <p>支持以下运算符和函数：</p>
                        <div class="syntax-grid">
                            <div class="syntax-item">
                                <code>+, -, *, /</code>
                                <span>基本运算</span>
                            </div>
                            <div class="syntax-item">
                                <code>^</code>
                                <span>幂运算</span>
                            </div>
                            <div class="syntax-item">
                                <code>sqrt(x)</code>
                                <span>平方根</span>
                            </div>
                            <div class="syntax-item">
                                <code>abs(x)</code>
                                <span>绝对值</span>
                            </div>
                            <div class="syntax-item">
                                <code>sin(x), cos(x), tan(x)</code>
                                <span>三角函数</span>
                            </div>
                            <div class="syntax-item">
                                <code>log(x), ln(x)</code>
                                <span>对数函数</span>
                            </div>
                            <div class="syntax-item">
                                <code>pi, e</code>
                                <span>常数</span>
                            </div>
                            <div class="syntax-item">
                                <code>2x</code>
                                <span>隐式乘法(2*x)</span>
                            </div>
                        </div>
                        
                        <h5>KaTeX数学表达式</h5>
                        <p>在表达式中可以使用KaTeX语法：</p>
                        <ul>
                            <li><code>\frac{1}{2}</code> 表示分数</li>
                            <li><code>\sqrt{x}</code> 表示平方根</li>
                            <li><code>x^{2}</code> 表示幂运算</li>
                            <li><code>\sin(x)</code> 表示三角函数</li>
                        </ul>
                        <p>示例: <code>\frac{x^2}{2} + \sin(2\pi x)</code></p>
                    </div>
                    
                    <div class="help-section">
                        <h4>变量与条件</h4>
                        <ul>
                            <li><strong>常数变量</strong>: 定义固定值，如 a = 3</li>
                            <li><strong>滑块变量</strong>: 可调整的变量，有最小/最大值</li>
                            <li><strong>限制条件</strong>: 为函数添加条件，如 x>0</li>
                            <li>变量可以在所有函数表达式中使用</li>
                        </ul>
                    </div>
                    
                    <div class="help-section">
                        <h4>自动补全</h4>
                        <p>输入函数名称时，会自动显示匹配的函数列表，按Tab键或点击选择自动补全。</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 主画布区域 -->
        <div class="main-canvas-container">
            <canvas id="graphCanvas"></canvas>
            
            <!-- 画布控制覆盖层 -->
            <div class="canvas-overlay">
                <div class="coordinate-display" id="coordinates">(0, 0)</div>
                <div class="zoom-display">
                    缩放: <span id="zoomLevel">1.00x</span>
                </div>
                <div class="quick-tools">
                    <button id="resetViewBtn" class="btn-overlay" title="重置视图">
                        <i class="fas fa-home"></i>
                    </button>
                    <button id="exportBtn" class="btn-overlay" title="保存图像">
                        <i class="fas fa-download"></i>
                    </button>
                    <button id="fullscreenBtn" class="btn-overlay" title="全屏">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 设置模态框 -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-cog"></i> 设置</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h4><i class="fas fa-language"></i> 语言设置</h4>
                    <div class="setting-item">
                        <label for="languageSelect">界面语言:</label>
                        <select id="languageSelect">
                            <option value="zh-CN">简体中文</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="errorLanguage">错误信息语言:</label>
                        <select id="errorLanguage">
                            <option value="zh-CN">中文</option>
                            <option value="en">英文</option>
                        </select>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4><i class="fas fa-chart-area"></i> 图形设置</h4>
                    <div class="setting-item">
                        <label for="gridDensity">网格密度:</label>
                        <select id="gridDensity">
                            <option value="low">低</option>
                            <option value="medium" selected>中</option>
                            <option value="high">高</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="axisLabels">坐标轴标签:</label>
                        <input type="checkbox" id="axisLabels" checked>
                    </div>
                    <div class="setting-item">
                        <label for="showGrid">显示网格:</label>
                        <input type="checkbox" id="showGrid" checked>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4><i class="fas fa-sliders-h"></i> 交互设置</h4>
                    <div class="setting-item">
                        <label for="zoomSensitivity">缩放灵敏度:</label>
                        <input type="range" id="zoomSensitivity" min="0.1" max="2" step="0.1" value="1">
                        <span id="zoomSensitivityValue">1.0</span>
                    </div>
                    <div class="setting-item">
                        <label for="dragSensitivity">拖动灵敏度:</label>
                        <input type="range" id="dragSensitivity" min="0.5" max="2" step="0.1" value="1">
                        <span id="dragSensitivityValue">1.0</span>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4><i class="fas fa-paint-brush"></i> 外观设置</h4>
                    <div class="setting-item">
                        <label for="themeSelect">主题:</label>
                        <select id="themeSelect">
                            <option value="light">浅色</option>
                            <option value="dark">深色</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="lineWidth">线条宽度:</label>
                        <input type="range" id="lineWidth" min="1" max="5" step="0.5" value="2">
                        <span id="lineWidthValue">2</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="saveSettingsBtn" class="btn-primary">保存设置</button>
                <button id="resetSettingsBtn" class="btn-secondary">恢复默认</button>
            </div>
        </div>
    </div>
    
    <!-- 颜色选择器模态框 -->
    <div id="colorPickerModal" class="modal">
        <!-- 颜色选择器内容 -->
    </div>
    
    <!-- 变量编辑模态框 -->
    <div id="variableModal" class="modal">
        <!-- 变量编辑内容 -->
    </div>
    
    <!-- 条件编辑模态框 -->
    <div id="conditionModal" class="modal">
        <!-- 条件编辑内容 -->
    </div>
    
    <!-- 自动补全浮窗 -->
    <div id="autocompleteDropdown" class="autocomplete-dropdown"></div>
    
    <!-- 加载KaTeX库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
